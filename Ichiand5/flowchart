ğŸ“˜ Usage Examples
1. Basic System Startup
bash


# Set environment variables
export DHAN_TOKEN_B64="your_base64_encoded_token"
export DHAN_CLIENT_B64="your_base64_encoded_client_id"
export TELEGRAM_TOKEN_B64="your_base64_encoded_bot_token"
export TELEGRAM_CHAT_ID="your_telegram_chat_id"

# Start the trading system
python main.py
2. Running with Custom Configuration
python


# custom_run.py - Run with modified settings
import os
import sys
from pathlib import Path

# Set custom configuration
os.environ['MIN_SIGNAL_STRENGTH'] = '0.7'  # Increase minimum signal strength
os.environ['COOLDOWN_SECONDS'] = '600'     # 10 minute cooldown
os.environ['MIN_CONFIDENCE'] = '75'        # Higher confidence threshold

# Import and run main
from main import main
main()
3. Historical Backtesting
bash


# Run backtest with validation
python historical_data.py \
    --timeframe daily \
    --from 2024-01-01 \
    --to 2024-12-01 \
    --validate \
    --charts \
    --output reports/backtest_2024.csv

# Test specific indicator combinations
python historical_data.py \
    --indicators ichimoku,adx,bollinger \
    --weights 0.4,0.3,0.3 \
    --test-mode
4. Signal Validation Testing
python


# test_signals.py - Test signal validation
from signal_validator import SignalValidator
from config import CONFIG
import pandas as pd

# Create test data
test_df = pd.DataFrame({
    'close': [19800, 19850, 19900, 19880, 19920],
    'volume': [1000000, 1200000, 1500000, 1100000, 1300000]
})

# Initialize validator
validator = SignalValidator(CONFIG)

# Test signal
test_signal = {
    'composite_signal': 'STRONG BUY',
    'weighted_score': 0.75,
    'confidence': 80,
    'active_indicators': 5
}

# Validate
is_valid, details = validator.validate_signal(test_signal, test_df, {})
print(f"Valid: {is_valid}")
print(f"Details: {details}")
5. Generate Performance Report
bash


# Generate HTML report with charts
python generate_report.py \
    --input data/ \
    --output reports/performance.html \
    --include-charts \
    --date-range 30

# Quick system health check
python health_check.py --verbose
ğŸ“Š Enhanced System Flowchart
mermaid


flowchart TD
    Start([ğŸš€ System Start]) --> EnvCheck{Check Environment Variables}
    EnvCheck -->|Missing| ErrorExit[âŒ Exit with Error]
    EnvCheck -->|Valid| InitConfig[Load CONFIG]
    
    InitConfig --> ValidateConfig{Validate Configuration}
    ValidateConfig -->|Invalid| ErrorExit
    ValidateConfig -->|Valid| InitLogging[Setup Logging]
    
    InitLogging --> InitTelegram[Initialize Telegram Bot]
    InitTelegram --> TestTelegram{Test Telegram Connection}
    TestTelegram -->|Failed| WarnContinue[âš ï¸ Warning & Continue]
    TestTelegram -->|Success| SendStartup[ğŸ“¨ Send Startup Message]
    
    WarnContinue --> InitMonitor
    SendStartup --> InitMonitor[Initialize Signal Monitor]
    InitMonitor --> StartMonitorThread[Start Monitor Thread]
    
    StartMonitorThread --> InitWebSocket[Initialize WebSocket Client]
    InitWebSocket --> ConnectWS{Connect to Dhan WebSocket}
    ConnectWS -->|Failed| RetryLogic{Retry with Backoff?}
    RetryLogic -->|Max Retries| ErrorNotify[Send Error to Telegram]
    ErrorNotify --> ErrorExit
    RetryLogic -->|Retry| ConnectWS
    
    ConnectWS -->|Success| Subscribe[Subscribe to NIFTY50]
    Subscribe --> StartHeartbeat[Start Heartbeat Thread]
    StartHeartbeat --> StartHealthMonitor[Start Health Monitor Thread]
    
    StartHealthMonitor --> DataLoop[ğŸ“Š Data Reception Loop]
    
    DataLoop --> ReceivePacket[Receive Market Data Packet]
    ReceivePacket --> ParsePacket{Parse Packet Type}
    
    ParsePacket -->|16 bytes| TickPacket[Parse Tick Data]
    ParsePacket -->|32 bytes| DetailedPacket[Parse Detailed Data]
    ParsePacket -->|JSON| JSONPacket[Parse JSON Data]
    ParsePacket -->|Unknown| DropPacket[Drop Unknown Packet]
    
    TickPacket --> ValidatePrice{Price Sanity Check}
    DetailedPacket --> ValidatePrice
    JSONPacket --> ValidatePrice
    DropPacket --> DataLoop
    
    ValidatePrice -->|Invalid| LogWarning[Log Warning]
    LogWarning --> DataLoop
    ValidatePrice -->|Valid| AddToBuffer[Add to Tick Buffer]
    
    AddToBuffer --> CheckMinute{New Minute?}
    CheckMinute -->|No| DataLoop
    CheckMinute -->|Yes| CreateCandle[Create OHLCV Candle]
    
    CreateCandle --> CheckDataPoints{â‰¥ MIN_DATA_POINTS?}
    CheckDataPoints -->|No| ShowProgress[Show Progress]
    ShowProgress --> DataLoop
    CheckDataPoints -->|Yes| CalcIndicators[Calculate All 6 Indicators]
    
    CalcIndicators --> Parallel{Parallel Calculation}
    Parallel --> Ichimoku[ğŸ“Š Ichimoku Cloud]
    Parallel --> Stochastic[ğŸ“Š Stochastic]
    Parallel --> OBV[ğŸ“Š OBV]
    Parallel --> Bollinger[ğŸ“Š Bollinger Bands]
    Parallel --> ADX[ğŸ“Š ADX]
    Parallel --> ATR[ğŸ“Š ATR]
    
    Ichimoku --> MergeResults[Merge Indicator Results]
    Stochastic --> MergeResults
    OBV --> MergeResults
    Bollinger --> MergeResults
    ADX --> MergeResults
    ATR --> MergeResults
    
    MergeResults --> GenerateSignal[Generate Weighted Signal]
    GenerateSignal --> ValidateSignal[ğŸ›¡ï¸ Validate Signal]
    
    ValidateSignal --> ValidationChecks{Multi-Factor Validation}
    ValidationChecks --> VolumeCheck[Volume Confirmation]
    ValidationChecks --> TrendCheck[Trend Alignment]
    ValidationChecks --> VolatilityCheck[Volatility Check]
    ValidationChecks --> DivergenceCheck[Divergence Check]
    ValidationChecks --> SupportResistance[S/R Levels]
    
    VolumeCheck --> ValidationScore[Calculate Validation Score]
    TrendCheck --> ValidationScore
    VolatilityCheck --> ValidationScore
    DivergenceCheck --> ValidationScore
    SupportResistance --> ValidationScore
    
    ValidationScore --> IsValid{Valid Signal?}
    IsValid -->|No| LogRejection[Log Rejection Reasons]
    LogRejection --> DataLoop
    
    IsValid -->|Yes| PredictDuration[â±ï¸ Predict Signal Duration]
    PredictDuration --> CheckAlertCriteria{Check Alert Criteria}
    
    CheckAlertCriteria --> StrengthCheck{Signal Strength â‰¥ MIN?}
    StrengthCheck -->|No| DataLoop
    StrengthCheck -->|Yes| ConfidenceCheck{Confidence â‰¥ MIN?}
    ConfidenceCheck -->|No| DataLoop
    ConfidenceCheck -->|Yes| IndicatorCheck{Active Indicators â‰¥ MIN?}
    IndicatorCheck -->|No| DataLoop
    IndicatorCheck -->|Yes| CooldownCheck{Cooldown Active?}
    CooldownCheck -->|Yes| DataLoop
    
    CooldownCheck -->|No| GenerateChart{Generate Chart?}
    GenerateChart -->|Disabled| FormatAlert
    GenerateChart -->|Enabled| CreateChart[ğŸ“ˆ Create Technical Chart]
    CreateChart --> SaveChart[Save Chart Image]
    SaveChart --> FormatAlert[Format Alert Message]
    
    FormatAlert --> SendTelegram[ğŸ“¨ Send Telegram Alert]
    SendTelegram --> UpdateMonitor[Update Signal Monitor]
    UpdateMonitor --> UpdateHistory[Update Alert History]
    UpdateHistory --> DataLoop
    
    DataLoop --> HealthCheck{Health Check Due?}
    HealthCheck -->|No| DataLoop
    HealthCheck -->|Yes| CheckHealth[Check System Health]
    CheckHealth --> Healthy{System Healthy?}
    Healthy -->|No| RestartComponent[Restart Unhealthy Component]
    RestartComponent --> DataLoop
    Healthy -->|Yes| LogMetrics[Log Performance Metrics]
    LogMetrics --> DataLoop
    
    DataLoop --> Shutdown{Shutdown Signal?}
    Shutdown -->|No| DataLoop
    Shutdown -->|Yes| Cleanup[Cleanup Resources]
    Cleanup --> SendStats[Send Session Statistics]
    SendStats --> End([ğŸ›‘ System Stop])
ğŸ“ Complete File Hierarchy
text


enhanced_trading_system/
â”œâ”€â”€ ğŸ“„ main.py                        # Entry point with health monitoring
â”œâ”€â”€ ğŸ“„ config.py                      # Unified configuration with CONFIG instance
â”œâ”€â”€ ğŸ“„ websocket_client.py            # Enhanced WebSocket with 6 indicators
â”œâ”€â”€ ğŸ“„ signal_monitor.py              # Signal tracking and performance monitoring
â”œâ”€â”€ ğŸ“„ technical_indicators.py        # All 6 indicator calculations
â”œâ”€â”€ ğŸ“„ signal_prediction.py           # Duration prediction system
â”œâ”€â”€ ğŸ“„ signal_validator.py            # Multi-factor signal validation
â”œâ”€â”€ ğŸ“„ chart_generator.py             # Technical analysis chart generation
â”œâ”€â”€ ğŸ“„ telegram_bot.py                # Alert notifications with charts
â”œâ”€â”€ ğŸ“„ logging_setup.py               # Centralized logging configuration
â”œâ”€â”€ ğŸ“„ historical_data.py             # Backtesting functionality
â”œâ”€â”€ ğŸ“„ health_check.py                # System health monitoring utility
â”œâ”€â”€ ğŸ“„ generate_report.py             # Performance report generator
â”œâ”€â”€ ğŸ“„ requirements.txt               # Python dependencies
â”œâ”€â”€ ğŸ“„ .env.example                   # Environment variables template
â”œâ”€â”€ ğŸ“„ README.md                      # Documentation
â”‚
â”œâ”€â”€ ğŸ“ logs/                          # Log files directory
â”‚   â”œâ”€â”€ trading_system.log           # Main system log
â”‚   â”œâ”€â”€ backtest.log                 # Backtesting log
â”‚   â””â”€â”€ error.log                    # Error-specific log
â”‚
â”œâ”€â”€ ğŸ“ images/                        # Generated charts
â”‚   â”œâ”€â”€ ğŸ“ signals/                  # Signal charts
â”‚   â”‚   â””â”€â”€ signal_YYYYMMDD_HHMMSS.png
â”‚   â””â”€â”€ ğŸ“ reports/                  # Report charts
â”‚       â””â”€â”€ performance_chart.png
â”‚
â”œâ”€â”€ ğŸ“ data/                          # Data storage
â”‚   â”œâ”€â”€ ğŸ“ candles/                  # Historical candle data
â”‚   â”‚   â””â”€â”€ nifty50_candles.csv
â”‚   â”œâ”€â”€ ğŸ“ signals/                  # Signal history
â”‚   â”‚   â””â”€â”€ signals_history.json
â”‚   â””â”€â”€ ğŸ“ backtest/                 # Backtest results
â”‚       â””â”€â”€ backtest_results.csv
â”‚
â”œâ”€â”€ ğŸ“ reports/                       # Generated reports
â”‚   â”œâ”€â”€ performance.html             # HTML performance report
â”‚   â”œâ”€â”€ backtest_2024.csv           # Backtest results
â”‚   â””â”€â”€ daily_summary.pdf           # Daily summary report
â”‚
â””â”€â”€ ğŸ“ tests/                         # Unit tests
    â”œâ”€â”€ test_indicators.py            # Indicator tests
    â”œâ”€â”€ test_validator.py             # Validator tests
    â””â”€â”€ test_signals.py               # Signal generation tests
ğŸ“¨ Expected Alert Outputs
1. Strong Buy Signal Alert
text


ğŸš€ STRONG BUY SIGNAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° Price: â‚¹19,845.50
ğŸ“Š Score: 0.825 (82.5%)
ğŸ¯ Confidence: 87.5%
âœ… Active Indicators: 6/6

â±ï¸ SIGNAL DURATION FORECAST:
â€¢ Expected Duration: 8 candles
â€¢ Confidence Level: HIGH (78.2%)
â€¢ Strength Decay: -8.5%/candle
â€¢ Validity Window: 5-12 candles

ğŸ“Š INDICATOR BREAKDOWN:
â€¢ Ichimoku: BULLISH (0.18/0.20)
â€¢ Stochastic: BUY (0.12/0.15)
â€¢ OBV: POSITIVE (0.13/0.15)
â€¢ Bollinger: OVERSOLD (0.14/0.15)
â€¢ ADX: STRONG TREND (0.17/0.20)
â€¢ ATR: NORMAL VOL (0.09/0.15)

ğŸ¯ KEY LEVELS:
â€¢ Resistance: â‚¹19,950.00
â€¢ Support: â‚¹19,750.00
â€¢ Stop Loss: â‚¹19,680.00
â€¢ Target 1: â‚¹19,920.00
â€¢ Target 2: â‚¹20,050.00

ğŸ“ˆ MARKET DYNAMICS:
âœ… Volume Confirmation: YES
âœ… Trend Alignment: BULLISH
âœ… Volatility: FAVORABLE
âš ï¸ Near Resistance: 105 points

â° Time: 10:35:42 IST

[Technical Chart Attached]
2. Sell Signal with Warning
text


ğŸ”´ SELL SIGNAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° Price: â‚¹20,125.75
ğŸ“Š Score: -0.65 (65.0%)
ğŸ¯ Confidence: 72.3%
âœ… Active Indicators: 5/6

â±ï¸ SIGNAL DURATION FORECAST:
â€¢ Expected Duration: 5 candles
â€¢ Confidence Level: MEDIUM (65.0%)
â€¢ Strength Decay: -12.0%/candle
â€¢ Validity Window: 3-7 candles

âš ï¸ VALIDATION WARNINGS:
â€¢ Volume below average (-15%)
â€¢ ADX showing weak trend
â€¢ Possible support at â‚¹20,050

ğŸ“Š INDICATOR CONSENSUS:
â€¢ BEARISH: 4 indicators
â€¢ NEUTRAL: 1 indicator
â€¢ BULLISH: 1 indicator

ğŸ’¡ RECOMMENDATION:
Consider partial position due to
mixed signals and nearby support.

â° Time: 14:22:15 IST
3. Crossover Alert
text


ğŸ”„ GOLDEN CROSS DETECTED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Crossover Type: Ichimoku Cloud
ğŸ’° Price: â‚¹19,680.25
ğŸ“ˆ Tenkan crosses above Kijun

ğŸ“Š SIGNAL STRENGTH:
â€¢ Primary Signal: BUY
â€¢ Score: 0.71
â€¢ Confidence: 75.8%

â±ï¸ HISTORICAL ACCURACY:
â€¢ This pattern: 78% success
â€¢ Avg gain: +2.3% (10 candles)
â€¢ Best timeframe: 8-15 candles

ğŸ¯ SUGGESTED ACTION:
Monitor for confirmation in next
2-3 candles before entry.

â° Time: 11:45:30 IST
4. Signal Invalidation Alert
text


âš ï¸ SIGNAL REJECTED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Signal Type: BUY
Score: 0.58 (Below threshold)

âŒ VALIDATION FAILED:
â€¢ Bearish divergence detected
â€¢ Volume not confirming move
â€¢ Too close to resistance
â€¢ Extreme volatility (ATR spike)

ğŸ“Š FAILED CHECKS: 4/7
â€¢ âŒ Volume Confirmation
â€¢ âœ… Trend Alignment  
â€¢ âŒ Volatility Check
â€¢ âŒ Divergence Check
â€¢ âŒ Support/Resistance
â€¢ âœ… Momentum Quality
â€¢ âœ… Signal Consistency

ğŸ’¡ Wait for better setup

â° Time: 13:15:22 IST
5. Performance Report (Periodic)
text


ğŸ“Š PERFORMANCE REPORT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Period: Last 50 Signals

ğŸ“ˆ SIGNAL STATISTICS:
â€¢ Total Signals: 50
â€¢ Strong Signals: 12
â€¢ Buy Signals: 28
â€¢ Sell Signals: 22

âœ… ACCURACY METRICS:
â€¢ Overall: 74.0%
â€¢ Strong Signals: 83.3%
â€¢ Buy Accuracy: 71.4%
â€¢ Sell Accuracy: 77.3%

â±ï¸ DURATION ACCURACY:
â€¢ Within Range: 68%
â€¢ Avg Deviation: Â±2.3 candles
â€¢ Best Predictor: ADX signals

ğŸ† TOP PERFORMERS:
1. Ichimoku: 78% accuracy
2. ADX: 76% accuracy
3. Bollinger: 72% accuracy

ğŸ“Š System Health: OPTIMAL
â° Updated: 15:30:00 IST
6. Market Condition Alert
text


âš¡ MARKET CONDITION CHANGE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Previous: TRENDING
Current: CHOPPY/WHIPSAW

âš ï¸ DETECTED PATTERNS:
â€¢ 7 signal changes in 10 candles
â€¢ Increased false signals
â€¢ Volatility spike detected

ğŸ“Š ADJUSTED PARAMETERS:
â€¢ MIN_SIGNAL_STRENGTH: 0.7â†’0.8
â€¢ COOLDOWN: 300sâ†’600s
â€¢ Required confirmations: 2â†’3

ğŸ’¡ RECOMMENDATION:
Reduce position sizes and wait
for clearer market direction.

â° Time: 10:00:45 IST